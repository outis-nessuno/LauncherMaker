#!/bin/bash
#~ Author: Outis
#~ Site: http://outis.altervista.org
#~ Mail: outis@altervista.org
#~ CopyLeft: CC BY-NC-SA (http://creativecommons.org/licenses/by-nc-sa/3.0/it/)
#~ Version: 1.0
#~ Date: 25/02/2012
#~ Dependences: Zenity (Created on Ubuntu 11.10 with Nautilus 3.2.1 and Zenity 3.2.0)

# Set the firts part of the title of zenity dialog boxes
SCRIPT_NAME=$(basename "$0")
# Icon displayed
WINDOW_ICON="question"

# Standard min dimensions aplied to many of the dialogs
ZEN_WIDTH_STANDARD=350
ZEN_HEIGHT_STANDARD=100
ZEN_WIDTH_INFO=800
ZEN_HEIGHT_INFO=300
ZEN_WIDTH_EDIT=500
ZEN_HEIGHT_EDIT=350

# Text var for translations
ZEN_INFO_TITLE="Informazioni"
ZEN_INFO_TEXT="Launcher Maker\n------------------------\nAuthor: Outis\nSite: http://outis.altervista.org\nMail: outis@altervista.org\nCopyLeft: CC BY-NC-SA (http://creativecommons.org/licenses/by-nc-sa/3.0/)\nVersion: 1.0\nDate: 25/02/2012\nDependences: Zenity (Created on Ubuntu 11.10 with Nautilus 3.2.1 and Zenity 3.2.0)\n------------------------\nQuesto script aiuta nella creazione di launcher, guidando nella compilazione di un file testuale *.desktop secondo gli standard (http://standards.freedesktop.org/desktop-entry-spec/latest/).\n\nPer semplicità implementa solamente funzionalità di base, per finalità avanzate consiglio, dunque, di procedere con una modifica manuale del lanciatore con un editor di testo.\n\nIn particolare posso suggerire, a chi interessato, spunti di approfondimento:\n• Aggiunta di diversi locale per ciascun campo (Secondo gli standard forniti).\n• Inserimento del lanciatore all'elenco delle applicazioni (~/.local/share/applications/).\n• Aggiunta del lanciatore al dock di Unity con shortcut a comandi correlati (X-Ayatana-Desktop-Shortcuts); (Nota: solo i lanciatori di applicazioni possono comparire nel dock, ma per emulare i link basta inserire come comando \"xdg-open { file | URL }\").\n\nRicordo che questo script è stato creato come utility personale senza test né garanzie, quindi possibili malfunzionamenti o danni sono responsabilità dell'utilizzatore."
ZEN_INFO_CONTINUE="Continua con la procedura"
ZEN_INFO_EXIT="Esci"
ZEN_NAME_TITLE="Nome"
ZEN_NAME_TEXT="Dai un nome al lanciatore."
ZEN_COMMENT_TITLE="Commento"
ZEN_COMMENT_TEXT="Esprimi un commento."
ZEN_ICON_TITLE="Icona"
ZEN_ICON_TEXT_1="Come vuoi scegliere l'icona?"
ZEN_ICON_SELECT="Seleziona File"
ZEN_ICON_MANUAL="Inserisci Manualmente"
ZEN_ICON_IMG_FILTER="*.jpg *.png *.gif *.svg"
ZEN_ICON_TEXT_2="Inserire il nome di un'icona standard\no il percorso completo ad un'immagine."
ZEN_TYPE_TITLE="Tipo"
ZEN_TYPE_TEXT="Selezionare il tipo di lanciatore."
ZEN_TYPE_APPLICATION="Applicazione"
ZEN_TYPE_LINK="Collegamento"
ZEN_COMMAND_TITLE="Comando"
ZEN_COMMAND_TEXT_1="Come si vuole inserire il comando?"
ZEN_COMMAND_SELECT="Seleziona File Eseguibile"
ZEN_COMMAND_MANUAL="Inserisci Manualmente"
ZEN_COMMAND_TEXT_2="Inserisci il percorso in cui siano eseguiti i comandi"
ZEN_COMMAND_TEXT_3="Inserisci un comando o il path di un file eseguibile."
ZEN_TERMINAL_TITLE="Terminale"
ZEN_TERMINAL_TEXT="Applicazione da eseguire nel terminale?"
ZEN_TERMINAL_TERMINAL="Terminale"
ZEN_TERMINAL_GRAPHIC="Grafica"
ZEN_LINK_TITLE="Collegamento"
ZEN_LINK_TEXT_1="Come si vuole inserire il collegamento?"
ZEN_LINK_SELECT="Seleziona File"
ZEN_LINK_MANUAL="Inserisci Manualmente"
ZEN_LINK_TEXT_2="Digitare un path o un URL valido."
ZEN_EDIT_TITLE="Modifica manuale"
ZEN_EDIT_CONFIRM="Salva"
ZEN_EDIT_DISCARD="Annulla Modifiche"
ZEN_SAVE_TITLE="Salva"

### Begining of the real script

echo -ne "$ZEN_INFO_TEXT" | zenity --text-info --ok-label="$ZEN_INFO_CONTINUE" --cancel-label="$ZEN_INFO_EXIT" --width=$ZEN_WIDTH_INFO --height=$ZEN_HEIGHT_INFO --font=monospace --title="$SCRIPT_NAME - $ZEN_INFO_TITLE" --window-icon="$WINDOW_ICON"
# 0 Continue, 1 Abort
if [ "$?" = "0" ]; then

	# String of the *.desktop file
	STR="#!/usr/bin/env xdg-open\n\n"
	STR="$STR""[Desktop Entry]\n"
	STR="$STR""Version=1.0\n"

	NAME=$(zenity --entry --text="$ZEN_NAME_TEXT" --title="$SCRIPT_NAME - $ZEN_NAME_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON")
	STR="$STR""Name=""$NAME""\n"

	COMMENT=$(zenity --entry --text="$ZEN_COMMENT_TEXT" --title="$SCRIPT_NAME - $ZEN_COMMENT_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON")
	STR="$STR""Comment=""$COMMENT""\n"

	zenity --question --ok-label="$ZEN_ICON_SELECT" --cancel-label="$ZEN_ICON_MANUAL" --text="$ZEN_ICON_TEXT_1" --title="$SCRIPT_NAME - $ZEN_ICON_TITLE" --window-icon="$WINDOW_ICON"
	# 0 Select, 1 Manual
	if [ "$?" = "0" ]; then
		ICON=$(zenity --file-selection --filename="$PWD/0" --file-filter="IMG | $ZEN_ICON_IMG_FILTER" --file-filter="ALL | *" --title="$SCRIPT_NAME - $ZEN_ICON_TITLE" --window-icon="$WINDOW_ICON")
	else
		ICON=$(zenity --entry --entry-text="$PWD/" --text="$ZEN_ICON_TEXT_2" --title="$SCRIPT_NAME  - $ZEN_ICON_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON")
	fi
	STR="$STR""Icon=""$ICON""\n"

	zenity --question --ok-label="$ZEN_TYPE_APPLICATION" --cancel-label="$ZEN_TYPE_LINK" --text="$ZEN_TYPE_TEXT" --title="$SCRIPT_NAME - $ZEN_TYPE_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON"
	# 0 Application, 1 Link
	if [ "$?" = "0" ]; then

		STR="$STR""Type=Application\n"

		zenity --question --ok-label="$ZEN_COMMAND_SELECT" --cancel-label="$ZEN_COMMAND_MANUAL" --text="$ZEN_COMMAND_TEXT_1" --title="$SCRIPT_NAME - $ZEN_COMMAND_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON"
		# 0 Select, 1 Manual
		if [ "$?" = "0" ]; then
			CMD=$(zenity --file-selection --filename="$PWD/0" --title="$SCRIPT_NAME - $ZEN_COMMAND_TITLE" --window-icon="$WINDOW_ICON")
		else
			PT=$(zenity --entry --entry-text="$PWD/" --text="$ZEN_COMMAND_TEXT_2" --title="$SCRIPT_NAME - $ZEN_COMMAND_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON")
			STR="$STR""Path=""$PT""\n"
			CMD=$(zenity --entry --text="$ZEN_COMMAND_TEXT_3" --title="$SCRIPT_NAME - $ZEN_COMMAND_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON")
		fi
		STR="$STR""Exec=""$CMD""\n"

		zenity --question --ok-label="$ZEN_TERMINAL_TERMINAL" --cancel-label="$ZEN_TERMINAL_GRAPHIC" --text="$ZEN_TERMINAL_TEXT" --title="$SCRIPT_NAME - $ZEN_TERMINAL_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON"
		# 0 Terminal, 1 Graphic
		if [ "$?" = "0" ]; then
			TERM="true"
		else
			TERM="false"
		fi
		STR="$STR""Terminal=""$TERM""\n"

	else

		STR="$STR""Type=Link\n"

		zenity --question --ok-label="$ZEN_LINK_SELECT" --cancel-label="$ZEN_LINK_MANUAL" --text="$ZEN_LINK_TEXT_1" --title="$SCRIPT_NAME - $ZEN_LINK_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON"
		# 0 Select, 1 Manual
		if [ "$?" = "0" ]; then
			URL="file://"$(zenity --file-selection --filename="$PWD/0" --title="$SCRIPT_NAME - $ZEN_LINK_TITLE" --window-icon="$WINDOW_ICON")
		else
			URL=$(zenity --entry --entry-text="file://$PWD/" --text="$ZEN_LINK_TEXT_2" --title="$SCRIPT_NAME - $ZEN_LINK_TITLE" --width=$ZEN_WIDTH_STANDARD --height=$ZEN_HEIGHT_STANDARD --window-icon="$WINDOW_ICON")
		fi
		STR="$STR""URL=""$URL""\n"

	fi

	EDIT=$(echo -ne "$STR" | zenity --text-info --editable --ok-label="$ZEN_EDIT_CONFIRM" --cancel-label="$ZEN_EDIT_DISCARD" --width=$ZEN_WIDTH_EDIT --height=$ZEN_HEIGHT_EDIT --font=monospace --title="$SCRIPT_NAME - $ZEN_EDIT_TITLE" --window-icon="$WINDOW_ICON")
	# 0 Modify, 1 Continue
	if [ "$?" = "0" ]; then
		STR="$EDIT"
	fi

	FILE=$(zenity --file-selection --save --confirm-overwrite --filename="$PWD/$NAME.desktop" --file-filter="LAUNCHER | *.desktop" --file-filter="ALL | *" --title="$SCRIPT_NAME - $ZEN_SAVE_TITLE" --window-icon="$WINDOW_ICON")
	# 0 Save, 1 Abort
	if [ "$?" = "0" ]; then
		echo -ne "$STR" > "$FILE"
		chmod +x "$FILE"
	fi

fi
